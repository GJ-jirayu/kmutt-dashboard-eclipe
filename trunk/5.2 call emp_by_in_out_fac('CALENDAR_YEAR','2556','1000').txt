CREATE PROCEDURE emp_by_in_out_fac(IN paramEmpTypeYear VARCHAR(256),IN paramEmpYear VARCHAR(256),IN paramEmpPos VARCHAR(256)) 
DYNAMIC RESULT SETS 1 
LANGUAGE SQL 
BEGIN 
    DECLARE result_set_1 CURSOR WITH RETURN TO CLIENT FOR
		select ORGENIZATION_NAME_SHORT
		,TypeStudy
		,total
		from
		(
		SELECT ORGENIZATION_NAME_SHORT
		, 'Inbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '1' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.CALENDAR_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE = '099')
		and (TRAINING_BOUNDARY_CODE = '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'Outbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '2' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.CALENDAR_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE != '099')
		and (TRAINING_BOUNDARY_CODE != '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'ToTal' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '3' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.CALENDAR_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		group by ORGENIZATION_NAME_SHORT
		)kmutt
		order by nos,ORGENIZATION_NAME_SHORT
	;               
		
	DECLARE result_set_2 CURSOR WITH RETURN TO CLIENT FOR
		select ORGENIZATION_NAME_SHORT
		,TypeStudy
		,total
		from
		(
		SELECT ORGENIZATION_NAME_SHORT
		, 'Inbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '1' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.FISCAL_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE = '099')
		and (TRAINING_BOUNDARY_CODE = '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'Outbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '2' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.FISCAL_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE != '099')
		and (TRAINING_BOUNDARY_CODE != '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'ToTal' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '3' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.FISCAL_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		group by ORGENIZATION_NAME_SHORT
		)kmutt
		order by nos,ORGENIZATION_NAME_SHORT	
	;
		
    DECLARE result_set_3 CURSOR WITH RETURN TO CLIENT FOR
		select ORGENIZATION_NAME_SHORT
		,TypeStudy
		,total
		from
		(
		SELECT ORGENIZATION_NAME_SHORT
		, 'Inbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '1' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.ACADAMIC_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE = '099')
		and (TRAINING_BOUNDARY_CODE = '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'Outbound' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '2' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.ACADAMIC_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		and (NATIONALITY_CODE != '099')
		and (TRAINING_BOUNDARY_CODE != '002')
		group by ORGENIZATION_NAME_SHORT

		union

		SELECT ORGENIZATION_NAME_SHORT
		, 'ToTal' as TypeStudy
		, count(distinct EMP_KEY) as total
		, '3' as nos
		FROM HR_FACT_TRAINING
		left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_TRAINING.MONTH_KEY
		left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_TRAINING.POSITION_GROUP_KEY
		left join HR_DIM_NATIONALITY on HR_DIM_NATIONALITY.NATIONALITY_KEY = HR_FACT_TRAINING.NATIONALITY_KEY
		left join HR_DIM_TRAINING_GROUP on HR_DIM_TRAINING_GROUP.TRAINING_GROUP_KEY = HR_FACT_TRAINING.TRAINING_GROUP_KEY
		left join HR_DIM_DEPARTMENT_TEST on HR_DIM_DEPARTMENT_TEST.DEPARTMENT_KEY = HR_FACT_TRAINING.DEPARTMENT_KEY
		where (DIM_DATE.ACADAMIC_YEAR in (paramEmpYear))
		and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
		group by ORGENIZATION_NAME_SHORT
		)kmutt
		order by nos,ORGENIZATION_NAME_SHORT		
	;        	
		
     IF (paramEmpTypeYear) = 'CALENDAR_YEAR' THEN
        OPEN  result_set_1;
     ELSEIF(paramEmpTypeYear) = 'FISCAL_YEAR' THEN
        OPEN  result_set_2;
     ELSE
        OPEN  result_set_3;
     END IF;
END
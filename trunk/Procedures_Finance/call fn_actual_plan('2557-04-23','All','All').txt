select ITEM_GROUP_NAME
, CASE WHEN YEARLY_BUDGET_AMOUNT <= 0 THEN 0 ELSE DECIMAL((dec(YTD_ACTUAL_AMOUNT,20,2)/YEARLY_BUDGET_AMOUNT) *100 ,20,2) END as amount
, YEARLY_BUDGET_AMOUNT
from 
(
SELECT CALENDAR_DATE
, ITEM_GROUP_NAME
, sum(YEARLY_BUDGET_AMOUNT) as YEARLY_BUDGET_AMOUNT
, CASE WHEN sum(YTD_ACTUAL_AMOUNT) < 0 THEN sum(YTD_ACTUAL_AMOUNT) * -1 ELSE sum(YTD_ACTUAL_AMOUNT) END AS YTD_ACTUAL_AMOUNT
FROM FN_DAILY_DEPARTMENT
left join DIM_DATE on DIM_DATE.DATE_KEY = FN_DAILY_DEPARTMENT.DATE_KEY
left join FN_DIM_DEPARTMENT on FN_DIM_DEPARTMENT.DEPARTMENT_KEY = FN_DAILY_DEPARTMENT.DEPARTMENT_KEY
where LEVEL_CODE = '1'
and LEVEL_LINE = '7'
and CALENDAR_DATE = '2556-10-03'
and (ORGENIZATION_CODE = '10100000')
-- and (DEPARTMENT_CODE = '10119000' )
group by CALENDAR_DATE,ITEM_GROUP_NAME
)
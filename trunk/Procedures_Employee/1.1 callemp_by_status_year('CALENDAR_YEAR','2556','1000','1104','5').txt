CREATE PROCEDURE emp_by_status_year(IN paramEmpTypeYear VARCHAR(256),IN paramEmpYear VARCHAR(256),IN paramEmpPos VARCHAR(256),IN paramEmpTypeLine VARCHAR(256),IN paramEmpYearSub VARCHAR(256)) 
DYNAMIC RESULT SETS 1 
LANGUAGE SQL 
BEGIN 
    DECLARE result_set_1 CURSOR WITH RETURN TO CLIENT FOR
	
		select CALENDAR_YEAR
		,EMP_TYPE_NAME
		,no_of_emp
		,EMP_TYPE_CODE
		from
		(        
			SELECT DIM_DATE.CALENDAR_YEAR
			,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
			,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
			FROM HR_FACT_EMPLOYEE
			left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
			left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
			left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
			left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
			-- where (DIM_DATE.CALENDAR_YEAR between ('2556') and ('2556'))
			where (DIM_DATE.CALENDAR_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
			and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
			and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
			group by DIM_DATE.CALENDAR_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			
			union
			
			select CALENDAR_YEAR
			,'รวม' as EMP_TYPE_NAME
			,sum(no_of_emp) as no_of_emp
			, 'All' as EMP_TYPE_CODE
			from
			(
					SELECT DIM_DATE.CALENDAR_YEAR
					,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
					,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
					,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
					FROM HR_FACT_EMPLOYEE
					left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
					left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
					left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
					left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
					-- where (DIM_DATE.CALENDAR_YEAR between ('2556') and ('2556'))
					where (DIM_DATE.CALENDAR_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
					and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
					and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
					group by DIM_DATE.CALENDAR_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			)kmutt
			group by CALENDAR_YEAR
		)gj	
		order by EMP_TYPE_CODE,CALENDAR_YEAR
	
	;               
		
	DECLARE result_set_2 CURSOR WITH RETURN TO CLIENT FOR

		select FISCAL_YEAR
		,EMP_TYPE_NAME
		,no_of_emp
		,EMP_TYPE_CODE
		from
		(
			SELECT DIM_DATE.FISCAL_YEAR
			,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
			,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
			FROM HR_FACT_EMPLOYEE
			left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
			left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
			left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
			left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
			-- where (DIM_DATE.FISCAL_YEAR between ('2556') and ('2556'))
			where (DIM_DATE.FISCAL_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
			and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
			and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
			group by DIM_DATE.FISCAL_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			
			union
			
			select FISCAL_YEAR
				,'รวม' as EMP_TYPE_NAME
				,sum(no_of_emp) as no_of_emp
				, 'All' as EMP_TYPE_CODE
				from
				(
					SELECT DIM_DATE.FISCAL_YEAR
					,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
					,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
					,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
					FROM HR_FACT_EMPLOYEE
					left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
					left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
					left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
					left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
					-- where (DIM_DATE.FISCAL_YEAR between ('2556') and ('2556'))
					where (DIM_DATE.FISCAL_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
					and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
					and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
					group by DIM_DATE.FISCAL_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
				)kmutt
			group by FISCAL_YEAR
		)gj	
		order by EMP_TYPE_CODE,FISCAL_YEAR
	
	;               
		
    DECLARE result_set_3 CURSOR WITH RETURN TO CLIENT FOR

		select ACADAMIC_YEAR
		,EMP_TYPE_NAME
		,no_of_emp
		,EMP_TYPE_CODE
		from
		(        
			SELECT DIM_DATE.ACADAMIC_YEAR
			,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
			,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
			FROM HR_FACT_EMPLOYEE
			left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
			left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
			left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
			left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
			-- where (DIM_DATE.ACADAMIC_YEAR between ('2556') and ('2556'))
			where (DIM_DATE.ACADAMIC_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
			and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
			and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
			group by DIM_DATE.ACADAMIC_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
			
			union
			
			select ACADAMIC_YEAR
				,'รวม' as EMP_TYPE_NAME
				,sum(no_of_emp) as no_of_emp
				, 'All' as EMP_TYPE_CODE
				from
				(
					SELECT DIM_DATE.ACADAMIC_YEAR
					,HR_DIM_EMP_TYPE.EMP_TYPE_NAME
					,count(distinct HR_FACT_EMPLOYEE.EMP_KEY) as no_of_emp
					,HR_DIM_EMP_TYPE.EMP_TYPE_CODE
					FROM HR_FACT_EMPLOYEE
					left join DIM_DATE on DIM_DATE.DATE_KEY = HR_FACT_EMPLOYEE.MONTH_KEY
					left join HR_DIM_POSITION_GROUP on HR_DIM_POSITION_GROUP.POSITION_GROUP_KEY = HR_FACT_EMPLOYEE.POSITION_GROUP_KEY
					left join HR_DIM_EMP_TYPE on HR_DIM_EMP_TYPE.EMP_TYPE_KEY = HR_FACT_EMPLOYEE.EMP_TYPE_KEY
					left join HR_DIM_EMP_LINE_GROUP on HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_KEY = HR_FACT_EMPLOYEE.EMP_LINE_KEY
					-- where (DIM_DATE.ACADAMIC_YEAR between ('2556') and ('2556'))
					where (DIM_DATE.ACADAMIC_YEAR between (paramEmpYear)-(paramEmpYearSub)+(1) and (paramEmpYear))
					and (HR_DIM_POSITION_GROUP.POSITION_GROUP_CODE in (paramEmpPos) or 'All' in (paramEmpPos))
					and (HR_DIM_EMP_TYPE.EMP_TYPE_GROUP_CODE || HR_DIM_EMP_LINE_GROUP.EMP_LINE_GROUP_CODE in (paramEmpTypeLine) or 'All' in (paramEmpTypeLine))
					group by DIM_DATE.ACADAMIC_YEAR, HR_DIM_EMP_TYPE.EMP_TYPE_CODE, HR_DIM_EMP_TYPE.EMP_TYPE_NAME
				)kmutt
			group by ACADAMIC_YEAR
		)gj	
		order by EMP_TYPE_CODE,ACADAMIC_YEAR
	
	;        	
		
     IF (paramEmpTypeYear) = 'CALENDAR_YEAR' THEN
        OPEN  result_set_1;
     ELSEIF(paramEmpTypeYear) = 'FISCAL_YEAR' THEN
        OPEN  result_set_2;
     ELSE
        OPEN  result_set_3;
     END IF;
END